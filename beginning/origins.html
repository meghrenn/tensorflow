<!DOCTYPE html>
<html lang="en-CAN">

<head>
    <title>Dig Deeper...</title>
    <link rel="icon" type="image/png" href="">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/history-hold.css">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="../js/scripts.js"></script>
</head>
<style>
    .locked {
        filter: brightness(0.1);
        opacity: 0.8;
    }

    .avail {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        animation: glow-animation 1s infinite alternate;
    }

    .seen {
        box-shadow: none !important;
        animation: none !important;
    }
</style>

<body id="hist-grid" class="medium" data-group-id="beginning" data-page-id="origins">
    <header class=" medium" id="main-header">
        <ul>
            <li id="about" class="basic-padding">About</li>
            <li id="help" class="basic-padding">Trouble</li>
            <li id="progress" class="basic-padding">Progress</li>
        </ul>
    </header>
    <div id="hist-hold">
        <div class="thick-padding containment">
            <h1>Origins</h1>
            <p>I can feel another vision coming on. Noâ€”not one vision, but many.</p>
            <p class="tangent">(A whirlwind of imagery, a twister of historical particulate.)</p>
            <p>They feel like memories, real scenes that played out. How far back can I see?
                How deep does this go?</p>
        </div>
        <img id="above" class="locked" src="../images/overhead/1956.jpg">
        <img id="fog" class="avail" src="../images/origins/bldg-plan1.png">
        <img id="controversy" class="locked" src="../images/origins/protest1.png">
        <!-- <img id="ameliorate" class="avail" src="../images/meliorist/first-edition.jpg"> -->
        <img id="puzzle" class="locked" src="../images/bug/vw-bug1.png">
        <img id="west" class="avail" src="../images/origins/bldg1.png">
        <img id="logo" class="locked" src="../images/coat-of-arms.jpg">
        <img id="construction" class="avail" src="../images/origins/1971.png">
        <!-- <img id="unearthed" class="locked" src="../images/meliorist/unearthed-photograph.jpg"> -->
        <img id="tale" class="locked" src="../images/students1.png">

        <!-- WE WOULD IF WE COULD -->

        <img id="worm" class="avail" src="../images/origins/worm3.png">


        <!-- <img style=" 
            src="../images/origins/Focus16_1.jpg" "../images/origins/Focus16_2.jpg"> -->
        <!-- <img style="top: 2000px; left: 550px; transform: translateX(170px) translateY(150px) rotate(95deg)"
            src="../images/origins/Focus16_3.jpg">
        <img  src="../images/origins/kyu.jpg"> -->
        <!-- <img id="finished-coulee" class="locked" style="top: 2000px; left: -10px;;" src="../images/origins/bldg3.png"> -->

    </div>
    <div id="header-container"></div>

    <script>
        const histHold = document.getElementById('hist-hold');

        var audio = new Audio('../audio/page-move2.wav');
        audio.volume = 0.7;
        audio.playbackRate = 2;
        histHold.addEventListener('mouseover', function (event) {
            if (event.target.closest('#hist-hold')) {
                audio.play();
            }
        });

        window.onload = function () {
            // Function to handle click events
            function handleClick(event, url) {
                // Check if the clicked element has the class "locked"
                if (event.target.classList.contains('locked')) {
                    event.preventDefault(); // Prevent the default action (navigation)
                } else {
                    window.location.href = url; // Navigate to the new page
                }
            }

            document.getElementById("worm").addEventListener("click", function (event) {
                handleClick(event, "../tunnel/worm.html");
            });
            document.getElementById("fog").addEventListener("click", function (event) {
                handleClick(event, "../architect/fog.html");
            });
            // document.getElementById("strike1").addEventListener("click", function (event) {
            //     handleClick(event, "../strike/2022.html");
            // });
            // document.getElementById("strike2").addEventListener("click", function (event) {
            //     handleClick(event, "../strike/2022.html");
            // });
            // document.getElementById("ameliorate").addEventListener("click", function (event) {
            //     handleClick(event, "../meliorist/ameliorate.html");
            // });
            document.getElementById("logo").addEventListener("click", function (event) {
                handleClick(event, "../monster/logo.html");
            });
            document.getElementById("tale").addEventListener("click", function (event) {
                handleClick(event, "../tale/goodbye.html");
            });
            document.getElementById("west").addEventListener("click", function (event) {
                handleClick(event, "../place/west.html");
            });
            document.getElementById("above").addEventListener("click", function (event) {
                handleClick(event, "../place/above.html");
            });
            document.getElementById("puzzle").addEventListener("click", function (event) {
                handleClick(event, "../puzzling/puzzle.html");
            });
            // document.getElementById("unearthed").addEventListener("click", function (event) {
            //     handleClick(event, "../meliorist/unearthed.html");
            // });
            document.getElementById("construction").addEventListener("click", function (event) {
                handleClick(event, "../puzzling/construction.html");
            });
        };

        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve gameProgress from local storage
            const gameProgress = JSON.parse(localStorage.getItem('gameProgress')) || [];

            // Get all child elements of #hist-hold
            let histHoldChildren = document.querySelectorAll('#hist-hold > *');

            // Iterate through each child element
            histHoldChildren.forEach(function (child) {
                let childId = child.id;

                // Check if the ID matches any pageId or groupId in the array
                let matchFound = gameProgress.some(function (item) {
                    return item.pageId === childId || item.groupId === childId;
                });

                // If a match is found, add the 'seen' class to the element
                if (matchFound) {
                    child.classList.add('seen');
                    child.classList.remove('locked');
                    child.classList.remove('avail');
                }
            });

            // Check if all specified groupIds are present in gameProgress
            const requiredGroupIds = ['beginning', 'architect', 'place', 'puzzling', 'tunnel'];
            const allRequiredIdsPresent = requiredGroupIds.every(groupId =>
                gameProgress.some(item => item.groupId === groupId)
            );

            // If all required groupIds are found, create and display the pink overlay and button
            if (allRequiredIdsPresent) {
                // Create the pink overlay element
                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = 0;
                overlay.style.left = 0;
                overlay.style.width = '100%';
                overlay.style.height = '100%';
                overlay.style.backgroundColor = 'rgba(0, 0, 0, 0)'; // Initial transparent pink
                overlay.style.zIndex = 1000;
                overlay.style.transition = 'background-color 1s ease-in-out'; // Fade-in transition
                document.body.appendChild(overlay);

                // Create the outer container for the button
                const outerContainer = document.createElement('div');
                outerContainer.classList.add('center-container', 'basic-padding', 'marginal-margin');

                // Create the button element
                const continueButton = document.createElement('div');
                continueButton.id = 'continue';
                continueButton.classList.add('button', 'basic-padding');
                continueButton.textContent = 'You have seen enough';

                // Append the button to the outer container
                outerContainer.appendChild(continueButton);

                // Append the outer container to the overlay
                overlay.appendChild(outerContainer);

                // Center the outer container within the overlay
                outerContainer.style.position = 'absolute';
                outerContainer.style.top = '50%';
                outerContainer.style.left = '50%';
                outerContainer.style.transform = 'translate(-50%, -50%)';

                // Trigger the fade-in of the overlay
                setTimeout(() => {
                    overlay.style.backgroundColor = 'rgba(0, 0, 0, 1)'; // Full bright pink
                }, 10); // Small delay to ensure the transition works
                continueButton.addEventListener('click', function () {
                    window.location.href = '../ending/encroaching-end.html';
                });
            }
        });



        const choseTail = localStorage.getItem('choseTail') === 'true';

        if (choseTail) {
            document.getElementById('tale').classList.add('avail');
            document.getElementById('tale').classList.remove('locked');
        } else {
            document.getElementById('tale').classList.add('locked');
            document.getElementById('tale').classList.remove('avail');
        }


        // // Get the container element by id
        // const container = document.getElementById('hist-hold');



        window.addEventListener('scroll', function () {
            const scrollTop = window.scrollY;
            const windowHeight = window.innerHeight;
            const pageHeight = histHold.offsetHeight;
            // document.body.scrollHeight;
            const opacity = 0 + (scrollTop / (pageHeight - windowHeight));

            // Create or select the darkening element
            let darkeningElement = document.querySelector('.darken');
            if (!darkeningElement) {
                darkeningElement = document.createElement('div');
                darkeningElement.classList.add('darken');
                document.body.appendChild(darkeningElement);
            }

            // Set opacity and adjust background color
            darkeningElement.style.opacity = opacity;
        });




    </script>
</body>

</html>